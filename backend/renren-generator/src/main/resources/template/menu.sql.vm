use zhonghaida;

DELIMITER ??
DROP PROCEDURE IF EXISTS schema_change??
CREATE PROCEDURE schema_change()

BEGIN

IF NOT EXISTS (SELECT * FROM sys_menu where url = '${moduleName}/${pathName}') THEN
-- 菜单SQL
INSERT INTO `sys_menu` (`parent_id`, `name`, `url`, `perms`, `type`, `icon`, `order_num`,`create_user_id`,`create_time`)
    VALUES ('1', '${comments}', '${moduleName}/${pathName}', NULL, '1', 'config', '6','1','2017-03-23 22:37:41');

-- 按钮父菜单ID
set @parentId = @@identity;

-- 菜单对应按钮SQL
INSERT INTO `sys_menu` (`parent_id`, `name`, `url`, `perms`, `type`, `icon`, `order_num`,`create_user_id`,`create_time`)
    SELECT @parentId, '列表', null, '${moduleName}:${pathName}:list', '2', null, '6','1','2017-03-23 22:37:41';
INSERT INTO `sys_menu` (`parent_id`, `name`, `url`, `perms`, `type`, `icon`, `order_num`,`create_user_id`,`create_time`)
    SELECT @parentId, '新增', null, '${moduleName}:${pathName}:create,${moduleName}:${pathName}:list', '2', null, '6','1','2017-03-23 22:37:41';
INSERT INTO `sys_menu` (`parent_id`, `name`, `url`, `perms`, `type`, `icon`, `order_num`,`create_user_id`,`create_time`)
    SELECT @parentId, '修改', null, '${moduleName}:${pathName}:update,${moduleName}:${pathName}:info,${moduleName}:${pathName}:list', '2', null, '6','1','2017-03-23 22:37:41';
INSERT INTO `sys_menu` (`parent_id`, `name`, `url`, `perms`, `type`, `icon`, `order_num`,`create_user_id`,`create_time`)
    SELECT @parentId, '删除', null, '${moduleName}:${pathName}:delete,${moduleName}:${pathName}:list', '2', null, '6','1','2017-03-23 22:37:41';
END IF;

END??
DELIMITER ;

CALL schema_change();